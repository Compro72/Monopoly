<!DOCTYPE html>
<html>

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>Monopoly</title>

<!-- Babylon.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
<script src="https://assets.babylonjs.com/generated/Assets.js"></script>
<script src="https://cdn.babylonjs.com/recast.js"></script>
<script src="https://cdn.babylonjs.com/ammo.js"></script>
<script src="https://cdn.babylonjs.com/havok/HavokPhysics_umd.js"></script>
<script src="https://cdn.babylonjs.com/cannon.js"></script>
<script src="https://cdn.babylonjs.com/Oimo.js"></script>
<script src="https://cdn.babylonjs.com/earcut.min.js"></script>
<script src="https://cdn.babylonjs.com/babylon.js"></script>
<script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
<script src="https://cdn.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
<script src="https://cdn.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
<script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.js"></script>
<script src="https://cdn.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
<script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
<script src="https://cdn.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

<style>

html, body {
	overflow: hidden;
	width: 100%;
	height: 100%;
	margin: 0;
	padding: 0;
}

#renderCanvas {
	width: 100%;
	height: 100%;
	touch-action: none;
}
            
#canvasZone {
	width: 100%;
	height: 100%;
}

</style>

</head>


<body>

<div id="canvasZone">
<canvas id="renderCanvas"></canvas>
</div>

<script>

var canvas = document.getElementById("renderCanvas");


let startRenderLoop = function (engine, canvas) {
	engine.runRenderLoop(function () {
		if (sceneToRender && sceneToRender.activeCamera) {
			sceneToRender.render();
		}
	});
}


var engine = null;
var scene = null;
var sceneToRender = null;


let createDefaultEngine = function() { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true,  disableWebGL2Support: false}); 
};


const createScene =  () => {
	const scene = new BABYLON.Scene(engine);

	scene.enablePhysics(new BABYLON.Vector3(0,-30,0), new BABYLON.CannonJSPlugin());

   /**** Set camera and light *****/
	const camera = new BABYLON.ArcRotateCamera("camera", -Math.PI / 2, Math.PI / 2.5, 10, new BABYLON.Vector3(0, 0, 0));
	camera.attachControl(canvas, true);
	const light = new BABYLON.HemisphericLight("light", new BABYLON.Vector3(1, 1, 0));

	// Ground
	const groundMat = new BABYLON.StandardMaterial("groundMat");
	groundMat.diffuseTexture = new BABYLON.Texture("https://miro.medium.com/v2/resize:fit:1200/1*vBf3JmpboL86C1Q12ZECjw.jpeg");

	const ground = BABYLON.MeshBuilder.CreateGround("ground", {width:10, height:10});
	ground.material = groundMat;


	const mat = new BABYLON.StandardMaterial("mat");
	const texture = new BABYLON.Texture("diceNumbers.png");
	mat.diffuseTexture = texture;

	var columns = 6;
	var rows = 1;

	const faceUV = new Array(6);

	for (let i = 0; i < 6; i++) {
		faceUV[i] = new BABYLON.Vector4(i / columns, 0, (i + 1) / columns, 1 / rows);
	}

	const options = {
		faceUV: faceUV,
		wrap: true,
		size: 0.25
	};

	const box = BABYLON.MeshBuilder.CreateBox("box", options);
	box.material = mat;
	box.position.y = 3;

	return scene;
}


window.initFunction = async function() {
	var asyncEngineCreation = async function() {
   	try {
      	return createDefaultEngine();
		} catch(e) {
			console.log("the available createEngine function failed. Creating the default engine instead");
			return createDefaultEngine();
		}
	}
	window.engine = await asyncEngineCreation();
	if (!engine) throw 'engine should not be null.';
	startRenderLoop(engine, canvas);
	window.scene = createScene();
};


initFunction().then(() => {sceneToRender = scene});


// Resize
window.addEventListener("resize", function () {
	engine.resize();
});

</script>

</body>

</html>
